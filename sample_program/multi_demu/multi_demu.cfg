/*
 * Copyright (c) 2023 Afrel Co., Ltd. 
 * All rights reserved
 */

INCLUDE("tecsgen.cfg");

#include "multi_demu.h"
/* SUB_TASKの優先度をMAIN_TASKより低くしている。セマフォで順序は厳密に保証 */
/* MAIN_TASK
   - 自動起動 (TA_ACT)
   - エントリ関数 Main
   - 優先度 MAIN_PRIORITY（低い数値ほど優先度が高い）
   - スタックサイズ STACK_SIZE
   - 他のタスクより高い優先度を持ち、起動時点で動作を開始する */
CRE_TSK(MAIN_TASK, { TA_ACT, 0, Main, MAIN_PRIORITY, STACK_SIZE, NULL });
CRE_TSK(SUB_TASK, { TA_ACT, 0, sub_task, MAIN_PRIORITY+1, STACK_SIZE, NULL });

/* SEM_MAIN:
   - MAIN_TASK が最初に動作できるように初期値を 1 に設定。
   - これにより MAIN_TASK は wai_sem(SEM_MAIN) に即時成功できる。
   - SUB_TASK はこのセマフォを sig_sem() で解放する。 */
CRE_SEM(SEM_MAIN, { TA_NULL, 1, 1 });

/* SEM_SUB:
   - 初期値 0 に設定。
   - SUB_TASK は最初、wai_sem(SEM_SUB) で待機状態になる。
   - MAIN_TASK が sig_sem(SEM_SUB) を呼ぶと実行が再開される。
   - この 2 つのセマフォが「Ping-Pong」動作の核となる。 */
CRE_SEM(SEM_SUB,  { TA_NULL, 0, 1 });
